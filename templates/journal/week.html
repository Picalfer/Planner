{% extends "base.html" %}
{% load static %}

{% block title %}Текущая неделя{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'journal/css/week.css' %}">
{% endblock %}

{% block content %}
    <div class="planner-grid">
        <div class="week-container">
            <div class="week-header">
                <div class="week-navigation">
                    <div id="week-nav-left">
                        <button id="prev-week" class="nav-button">←</button>
                        <button id="current-week" class="nav-button styled-button">Сегодня</button>
                    </div>
                    <h2>Неделя: <span id="week-range">
                        {{ week_start|date:"d.m.Y" }} — {{ week_end|date:"d.m.Y" }}
                    </span></h2>
                    <button id="next-week" class="nav-button">→</button>
                </div>

                <div class="week-stats">
                    <span class="points">{{ total_points }} баллов</span>
                </div>
            </div>

            <div class="week-content">
                <div class="days-column">
                    {% for day in days %}
                        <div class="day-card {% if day.today %}today{% endif %}">
                            <div class="day-header">
                                <h3>{{ day.day_name }}</h3>
                                <div>
                                    <span class="date">{{ day.date|date:"d.m" }}</span>
                                    <span class="points">
                                {{ day.tasks.count }} задач / {{ day.earned_points }} баллов
                            </span>
                                    <button class="add-task-btn" data-date="{{ day.date|date:'Y-m-d' }}">+</button>
                                </div>
                            </div>

                            <ul class="task-list">
                                {% for task in day.tasks.all %}
                                    <li class="task {% if task.is_done %}done{% endif %}" data-task-id="{{ task.id }}">
                                        <div class="task-main">
                                            <span class="task-title">{{ task.title }}</span>
                                            <div class="task-actions">
                                                <button class="task-toggle" title="Отметить выполненной">✓</button>
                                                <button class="task-edit" title="Редактировать">✎</button>
                                                <button class="task-delete" title="Удалить">×</button>
                                            </div>
                                        </div>
                                        {% if task.description %}
                                            <div class="task-description">{{ task.description }}</div>
                                        {% endif %}
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endfor %}
                </div>

                <div class="misc-column"></div>
            </div>
        </div>
    </div>

    <div id="task-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 class="modal-title">Добавить задачу</h3>
            <form id="task-form">
                <input type="hidden" id="task-date" name="date">
                <div class="form-group">
                    <label for="task-title">Название:</label>
                    <input type="text" id="task-title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="task-description">Описание:</label>
                    <textarea id="task-description" name="description"></textarea>
                </div>
                <button type="submit" class="styled-button">Добавить</button>
            </form>
        </div>
    </div>

    <div id="task-detail-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" id="close-task-modal">&times;</span>
            <h3 class="modal-title">Редактирование задачи</h3>
            <form id="task-edit-form">
                <input type="hidden" id="edit-task-id" name="id">
                <input type="hidden" id="edit-task-date" name="date">

                <div class="form-group">
                    <label for="edit-task-title">Название:</label>
                    <input type="text" id="edit-task-title" name="title" required>
                </div>

                <div class="form-group">
                    <label for="edit-task-description">Описание:</label>
                    <textarea id="edit-task-description" name="description"></textarea>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="edit-task-done" name="is_done">
                        <span>Выполнена</span>
                    </label>
                </div>

                <div class="form-actions">
                    <button type="button" class="danger-button" id="delete-task-btn">Удалить</button>
                    <button type="submit" class="styled-button">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <div id="confirm-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h3>Подтверждение удаления</h3>
            <p>Вы уверены, что хотите удалить эту задачу?</p>
            <div class="form-actions">
                <button type="button" class="nav-button" id="cancel-delete">Отмена</button>
                <button type="button" class="danger-button" id="confirm-delete">Удалить</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'journal/js/app.js' %}" type="module"></script>
{% endblock %}